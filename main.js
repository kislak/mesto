(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,a){var u,c,s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c=function(e){s._handleHeartClick(e.target,s)},(u="_heartClickHandler")in this?Object.defineProperty(this,u,{value:c,enumerable:!0,configurable:!0,writable:!0}):this[u]=c,this._name=e.name,this._link=e.link,this._id=e._id,this._likesLength=e.likes.length,this._templateSelector=r,this._handleCardClick=o,this._handleDeleteButtonClick=i,this._handleHeartClick=a,this._currentUserId=n,this._ownerId=e.owner._id,this._like_on=e.likes.map((function(e){return e._id})).includes(this._currentUserId)}var n,r;return n=t,(r=[{key:"generateCard",value:function(){return this._card=this._getElement(),this._picture=this._card.querySelector(".element__picture"),this._title=this._card.querySelector(".element__title"),this._heart=this._card.querySelector(".element__heart"),this._likeCounter=this._card.querySelector(".element__like-counter"),this._deleteButton=this._card.querySelector(".element__delete-button"),this._picture.src=this._link,this._picture.alt=this._name,this._title.textContent=this._name,this._like_on&&this._heart.classList.add("element__heart_active"),this._likeCounter.textContent=this._likesLength,this._deleteButton.hidden=!this._canDelete(),this._setEventListeners(),this._card}},{key:"deleteCard",value:function(){this._card.remove()}},{key:"setLike",value:function(e){this._like_on=e,this._like_on?this._heart.classList.add("element__heart_active"):this._heart.classList.remove("element__heart_active")}},{key:"isLiked",value:function(){return this._like_on}},{key:"setLikeCounter",value:function(e){this._likesLength=e,this._likeCounter.textContent=e}},{key:"_getElement",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._heart.addEventListener("click",this._heartClickHandler),this._deleteButton.addEventListener("click",(function(){e._handleDeleteButtonClick(e)})),this._picture.addEventListener("click",this._handleCardClick)}},{key:"_canDelete",value:function(){return this._ownerId==this._currentUserId}}])&&e(n.prototype,r),t}();function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function e(t,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"enableValidation",(function(){o._formElement=document.querySelector(o._formSelector),o._buttonElement=o._formElement.querySelector(o._submitButtonSelector),o._inputList=Array.from(o._formElement.querySelectorAll(o._inputSelector)),o._toggleButtonState(),o._inputList.forEach((function(e){e.addEventListener("input",(function(){e.validity.valid?o._hideInputError(e):o._showInputError(e),o._toggleButtonState()}))})),o._formElement.addEventListener("reset",o._resetFormHandler)})),n(this,"disableSubmitButton",(function(){o._buttonElement.disabled=!0})),n(this,"_toggleButtonState",(function(){o._buttonElement.disabled=o._hasInvalidInput()})),n(this,"_hasInvalidInput",(function(){return o._inputList.some((function(e){return!e.validity.valid}))})),n(this,"_showInputError",(function(e){var t=o._formElement.querySelector(".".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(o._errorClass),e.classList.add(o._fieldErrorClass)})),n(this,"_hideInputError",(function(e){var t=o._formElement.querySelector(".".concat(e.id,"-error"));t.textContent="",t.classList.remove(o._errorClass),e.classList.remove(o._fieldErrorClass)})),n(this,"_resetFormHandler",(function(){o._inputList.forEach((function(e){o._hideInputError(e)}))})),this._formSelector=r,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._errorClass=t.errorClass,this._fieldErrorClass=t.fieldErrorClass};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t,this._renderer=n}var t,n;return t=e,(n=[{key:"render",value:function(e,t){var n=this;e.forEach((function(e){n._renderer(e,t)}))}},{key:"addItem",value:function(e){this._container.append(e)}},{key:"prependItem",value:function(e){this._container.prepend(e)}}])&&o(t.prototype,n),e}(),a={inputSelector:".popup__field",submitButtonSelector:".popup__submit",errorClass:"popup__input-error_visible",fieldErrorClass:"popup__field_invalid"},u=document.querySelector(".elements__list"),c=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__avatar");function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._escapeHandler=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",this._escapeHandler)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._escapeHandler)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){t.stopPropagation();var n=t.target.classList;(n.contains("popup")||n.contains("popup__close"))&&e.close()}))}},{key:"_handleEscClose",value:function(e){"Escape"==e.key&&this.close()}}])&&f(t.prototype,n),e}();function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(r);if(o){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submitHandler=t,n._form=n._popup.querySelector(".popup__form"),n._button=n._popup.querySelector(".popup__submit"),n._buttonText=n._button.textContent,n._inputFileds=Array.from(n._form.querySelectorAll(".popup__field")),n}return t=a,(n=[{key:"close",value:function(){d(m(a.prototype),"close",this).call(this),this._form.reset()}},{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e._button.textContent="Сохраниние...",e._submitHandler(t,e._getInputValues(),e._button,e._buttonText)})),d(m(a.prototype),"setEventListeners",this).call(this)}},{key:"_getInputValues",value:function(){return Object.fromEntries(this._inputFileds.map((function(e){return[e.name,e.value]})))}}])&&_(t.prototype,n),a}(p);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(t),this._profileTitle=document.querySelector(n),this._profileAvatarImage=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._profileName.textContent,title:this._profileTitle.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.title;this._profileName.textContent=t,this._profileTitle.textContent=n}},{key:"setAvatar",value:function(e){this._profileAvatarImage.src=e}}])&&g(t.prototype,n),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(r);if(o){var n=L(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return O(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._picturePopupImage=t._popup.querySelector(".popup__image"),t._picturePopupImageName=t._popup.querySelector(".popup__image-name"),t}return t=a,(n=[{key:"open",value:function(e){var t=e.name,n=e.link;this._picturePopupImage.src=n,this._picturePopupImage.alt=t,this._picturePopupImageName.textContent=t,w(L(a.prototype),"open",this).call(this)}}])&&S(t.prototype,n),a}(p);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submitHandler=t,n._form=n._popup.querySelector(".popup__form"),n}return t=a,(n=[{key:"open",value:function(e){this._card=e,I(T(a.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e._submitHandler(e._card,t)})),I(T(a.prototype),"setEventListeners",this).call(this)}}])&&R(t.prototype,n),a}(p);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=new(function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"getUser",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"setUser",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._getResponseData(e)}))}},{key:"addCard",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._getResponseData(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"addLike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"removeLike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"updateAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._getResponseData(e)}))}},{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}}])&&B(t.prototype,n),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-25",headers:{authorization:"f852889b-4e45-42a6-a8c2-82025ba7c42c","Content-Type":"application/json"}}),H=new P(".popup_type_image"),A=new U(".popup_type_confirmation",(function(e,t){D.deleteCard(e._id).then((function(){e.deleteCard(),A.close()})).catch((function(e){console.log(e)}))})),N=function(e){A.open(e)},V=function(e,t){e.disabled=!0,t.isLiked()?D.removeLike(t._id).then((function(e){t.setLike(!1),t.setLikeCounter(e.likes.length)})).catch((function(e){console.log(e)})).finally((function(){e.disabled=!1})):D.addLike(t._id).then((function(e){t.setLike(!0),t.setLikeCounter(e.likes.length)})).catch((function(e){console.log(e)})).finally((function(){e.disabled=!1}))},F=function(e,n){return new t(e,n,"#element-template",(function(){H.open(e)}),N,V).generateCard()},J=new k(".profile__name-text",".profile__title",".profile__avatar-image"),z=new r(a,'form[name="editProfile"]'),M=new b(".popup_type_edit-profile",(function(e,t,n,r){var o=t.name,i=t.title;D.setUser(o,i).then((function(e){J.setUserInfo({name:e.name,title:e.about}),M.close()})).catch((function(e){console.log(e)})).finally((function(){n.textContent=r}))})),G=M._form.querySelector("#popup__input-profile-name"),K=M._form.querySelector("#popup__input-profile-title"),Q=new b(".popup_type_avatar",(function(e,t,n,r){var o=t.link;D.updateAvatar(o).then((function(e){J.setAvatar(e.avatar),Q.close()})).catch((function(e){console.log(e)})).finally((function(){n.textContent=r}))})),W=new r(a,'form[name="changeAvatar"]'),X=new r(a,'form[name="addPlace"]'),Y=new i(u,(function(e,t){Y.addItem(F(e,t))})),Z=new b(".popup_type_add-place",(function(e,t,n,r){var o=t.name,i=t.link;D.addCard(o,i).then((function(e){Y.prependItem(F(e,e.owner._id)),Z.close()})).catch((function(e){console.log(e)})).finally((function(){n.textContent=r}))}));A.setEventListeners(),M.setEventListeners(),Q.setEventListeners(),H.setEventListeners(),Z.setEventListeners(),W.enableValidation(),z.enableValidation(),X.enableValidation(),s.addEventListener("click",(function(){var e=J.getUserInfo(),t=e.name,n=e.title;G.value=t,K.value=n,z.disableSubmitButton(),M.open()})),l.addEventListener("click",(function(){W.disableSubmitButton(),Q.open()})),c.addEventListener("click",(function(){X.disableSubmitButton(),Z.open()})),Promise.all([D.getUser(),D.getInitialCards()]).then((function(e){var t=e[0],n=e[1];J.setUserInfo({name:t.name,title:t.about}),J.setAvatar(t.avatar),Y.render(n,t._id)})).catch((function(e){console.log(e)}))})();